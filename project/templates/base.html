<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}VitalSync{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        (function() {
            const theme = localStorage.getItem('theme');
            if (theme === 'dark') {
                document.documentElement.classList.add('dark-mode');
            }
        })();
    </script>
</head>
<body>
    <nav class="navbar">
        <a href="{{ url_for('main.home') }}" class="nav-brand">VitalSync</a>
        <div class="nav-links">
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('main.assistant') }}">AI Assistant</a>
                <a href="{{ url_for('main.home') }}">Dashboard</a>
                <a href="{{ url_for('main.tracking') }}">Health Tracking</a>
                <a href="{{ url_for('main.diet') }}">Diet Planner</a>
                <span>Welcome, <strong>{{ current_user.name }}</strong>!</span>
                <a href="{{ url_for('auth.logout') }}">Logout</a>
            {% else %}
                <a href="{{ url_for('auth.login') }}">Login</a>
                <a href="{{ url_for('auth.register') }}">Register</a>
            {% endif %}
            <div class="theme-switch-wrapper">
                <label class="theme-switch" for="theme-checkbox">
                    <input type="checkbox" id="theme-checkbox" />
                    <div class="slider round"></div>
                </label>
            </div>
        </div>
    </nav>
    <div class="content">
        {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="flash-message">{{ messages[0] }}</div>
        {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.getElementById('theme-checkbox');
            if (localStorage.getItem('theme') === 'dark') {
                themeToggle.checked = true;
            }
            themeToggle.addEventListener('change', function() {
                if(this.checked) {
                    document.documentElement.classList.add('dark-mode');
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.documentElement.classList.remove('dark-mode');
                    localStorage.setItem('theme', 'light');
                }
            });
        });
    </script>
</body>
</html>